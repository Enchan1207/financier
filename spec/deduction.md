# 仕様

控除とは、厚生年金保険料や任意保険料、通信費など、月毎に発生する支出を指す。

## ドメインモデル

financierでは、控除を定義と実績とに分けて扱う。
それぞれ**控除定義 _DeductionDefinition_**, **控除実績 _DeductionRecord_** と呼称する。

### 控除定義

控除定義は種別、値、期間、そして課税フラグをもつ。

報酬は以下の種類が存在する:

- **絶対値** `absolute`: 毎月定数的に発生するもの
- **相対値**　`related_by_workday`: 勤務日数に従って定数倍的に発生するもの
- **標準報酬月額に対する比率** `related_by_standard_income`: 標準報酬月額に従って一定割合で発生するもの
- **報酬全額に対する比率**　`related_by_total_income`: その月の報酬全体に従って一定割合で発生するもの

期間は月単位で設定される。また報酬と同様、定義ごとにその期間を保持する。

### 控除実績

控除実績の値はその種別ごとに異なる。
前提として、その月に発生する報酬が計算されており、総額を $I_a$, 課税対象の総額を $I_t$ とする。
また月度における勤務日数を $w$ , 定義における値を $v$ とする。

- 絶対値: $v$
- 相対値: $v \times w$
- 標準報酬月額に対する比率: $v \times I_t$
- 報酬全額に対する比率: $v \times I_a$

実績値は月毎に自動計算されるが、システムの計算に問題がある場合を考慮し、ユーザが値を指定できるようにする。

## 提供する機能

定義の作成・更新・参照および実績の参照・更新・削除(自動計算に戻す)機能を提供する。
定義の削除は実績の管理が大変になるため、現状では提供しないものとする。

### 定義の作成

控除定義を作成する際は以下に示す値を渡す。

- 名称
- 種別
- 値
- 課税フラグ
- 有効期間

有効期間の単位は会計月度とする。開始月初から終了月末までを有効期間とする。

### 定義の更新

既存の控除定義はいつでもその内容を変更することができる。
変更の履歴は保持されない。

### 定義の参照

控除定義は以下に示す条件でクエリできる。

- 種別
- 期間: 以下のいずれかを選択する。
  - 単月: 有効期間にその月が含まれる定義を取得する。
  - 範囲: ある期間がその有効期間と重なる定義を取得する。

### 実績の参照

控除定義に基づいて計算された実績値を参照できる。

### 実績の更新

計算された実績値に問題がある場合、ユーザは手動で値を更新することができる。
実績の登録後に定義の有効期間が変更され、実績が有効期間から外れた場合、その実績は削除される。

### 実績の削除(自動計算に戻す)

ユーザが手動で更新した実績値を削除し、システムによる自動計算値に戻すことができる。
