# 260214 usecases

## 0️⃣ システムの前提構造

- トランザクション（履歴）
- 年度
- 年度予算（カテゴリ別）
- 積立（目標型／自由型）
- イベント（グループ）
- イベントテンプレート
- 内部残高（派生値）
- 自由残高（派生値）

## 1️⃣ トランザクション系

### 1-1 単一取引の登録

**ワークフロー**

1. 金額入力
2. 日付入力（未来可）
3. カテゴリ選択
4. 任意でイベント紐付け
5. 保存

**影響**

- 内部残高更新（当該年度到達時）
- 年度予算実績更新（当該年度のみ）

### 1-2 未来日取引の登録

- 当該年度に入るまで予算・残高に影響しない
- 年度表示でのみ集計対象

### 1-3 取引の編集

- 未締め年度のみ可能
- 締め年度は閲覧のみ

### 1-4 取引削除

- 未締め年度のみ可能
- 内部残高再計算

### 1-5 カテゴリ未定義取引の処理

- 新カテゴリ作成
- 既存カテゴリ再配分（予算再設定）

## 2️⃣ イベント系

### 2-1 イベント作成

例：金沢旅行

- 名前
- 期間（任意）

### 2-2 取引をイベントに紐付け

- 既存取引に後付け可能
- 年度跨ぎOK

### 2-3 イベント単位集計閲覧

- 合計金額
- カテゴリ内訳
- 年度別内訳

### 2-4 イベントテンプレート作成

例：

- 給与セット
- 旅行セット
- ボーナス配分

### 2-5 テンプレートから一括登録

- ダイアログ表示
- 金額調整
- 一括保存

### 2-6 イベント編集

- 名称変更可
- 前年度取引はロック

## 3️⃣ 予算系（年度専属）

### 3-1 年度予算作成

- 新年度開始時
- 前年度コピー可

### 3-2 カテゴリ予算設定

- 金額入力
- 合計表示
- 収入＞支出推奨

### 3-3 予算再配分

HDDパーティション的操作：

- Aカテゴリを減額
- Bカテゴリを増額
- 差分表示

強制制約なし、警告のみ。

### 3-4 突発出費対応

- 新カテゴリ作成
- 既存予算を再配分

### 3-5 年度予算実績確認

- 実績 vs 予算
- 差分表示（超過も許容）

## 4️⃣ 積立系（年度非依存）

### 4-1 積立作成

#### 目標型

- 目標額
- 期限
- 月割目安自動表示

#### 自由型

- 目標なし
- 累積のみ

### 4-2 積立への拠出

方法A：

- 専用カテゴリ支出として扱う

方法B：

- 積立専用操作（内部振替）

（設計選択ポイント）

### 4-3 積立充足率確認

- 進捗％
- 残額
- 月割目安との差分

### 4-4 積立取り崩し

- 積立残高減少
- 実支出とは別管理

### 4-5 積立完了

- クローズ
- 履歴保存

## 5️⃣ 内部残高・自由残高系

### 5-1 ダッシュボード表示

- 内部残高（全期間）
- 積立合計
- 自由残高

### 5-2 投資判断ユースケース

例：
「20万の買い物をしても安全か？」

- 自由残高と比較
- 積立充足率を確認

### 5-3 財政体力の推移表示

- 年度別残高推移
- イベント単位影響分析

## 6️⃣ 年度締め系

### 6-1 年度締め実行

処理：

1. 前年度取引ロック
2. 前年度予算固定
3. 次年度予算生成（コピー可）
4. 積立はそのまま
5. イベントはそのまま

### 6-2 締め後の修正

- 原則不可
- 管理者解除（任意）

## 7️⃣ 分析系

### 7-1 カテゴリ別年度分析

### 7-2 イベント別分析

### 7-3 積立進捗分析

### 7-4 年度間比較

### 7-5 収入 vs 支出推移

## 8️⃣ シナリオ系ユースケース（あなたが出した例）

### 8-1 節約 → 余剰再配分

### 8-2 突発出費 → 予算再編

### 8-3 旅行総額把握

### 8-4 未来予約処理

### 8-5 年度跨ぎイベント

### 8-6 投資判断

## 9️⃣ 状態遷移系

### 年度

- Draft → Active → Closed

### 積立

- Active → Completed → Archived

### イベント

- Active → Archived

## 🔟 潜在的エッジケース

- マイナス内部残高
- 積立総額 > 内部残高
- 予算未設定年度
- 未来年度の大量取引
- イベント削除時の取引処理
