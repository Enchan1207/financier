# 260213 個人財務マネジメントシステム 昨日仕様

## 1. システム目的

本システムは、利用者の財務意思決定を支援するための管理ツールである。

特徴：

- 年度主義による予算管理
- 全期間累積の内部残高表示
- 積立による将来意思管理
- イベントによる横断集計
- 強制的制約を設けない設計

本システムは完全会計を目的としない。

## 2. 基本概念

### 2.1 トランザクション

収入または支出の記録単位。

#### 属性

- id
- type（income / expense）
- amount
- categoryId
- transactionDate（発生日）
- eventId（nullable）
- memo
- createdAt

#### 仕様

- transactionDate により年度帰属が決定される
- 未来日入力可能
- 未来年度の取引は、その年度に入った時点で予算へ影響
- 年度締め後のトランザクションは編集不可

### 2.2 内部残高

```
内部残高 = 全期間の収入合計 − 全期間の支出合計
```

#### 特徴

- 全期間累積
- 年度に依存しない
- 永続保存不要（派生値）
- 実口座残高とは一致保証しない
- 未来取引は含めない

目的：

> 財政体力の可視化

### 2.3 自由残高

```
自由残高 = 内部残高 − 積立残高合計
```

表示上のみ差し引く。
積立は実拘束しない。

## 3. 予算管理（年度専属）

### 3.1 年度

- 会計単位
- 締め操作が存在する

#### 年度締め時の動作

1. 当該年度トランザクションをロック
2. 当該年度予算を固定
3. 次年度を生成（任意で前年度コピー）
4. 積立は変更なし
5. イベントは変更なし

### 3.2 年度予算

カテゴリ単位で設定。

#### 属性

- fiscalYear
- categoryId
- budgetAmount

#### 特徴

- 強制制約ではない
- 超過入力を禁止しない
- 実績との差分を可視化する
- 未使用予算は繰越しない（消滅）

#### 整合条件（警告のみ）

```
年度支出予算合計 ≤ 年度収入予算合計 + 前年度繰越収支差分
```

## 4. 積立

年度非依存の独立概念。

### 4.1 積立の型

#### ① 目標型

- targetAmount
- deadline
- currentAmount

表示：

```
月次目安額 = (残額 / 残月数)
```

#### ② 自由型

- targetなし
- 単純累積表示

### 4.2 積立の性質

- 内部残高を実際には減らさない
- 自由残高表示にのみ影響
- 年度締めで変化しない
- トランザクションと紐付け可能（任意）

積立は：

> 将来支出への意思ラベル付き内部バケット

## 5. イベント

トランザクションを横断的に束ねる概念。

### 5.1 Event

#### 属性

- id
- name
- dateRange（任意）

#### 特徴

- 年度跨ぎ可能
- 編集可能
- 前年度トランザクションはロックされる

用途：

- 旅行
- 家電購入
- 給与一式
- 特定プロジェクト支出

### 5.2 EventTemplate

イベントのテンプレート。

#### 属性

- id
- name
- defaultTransactions[]

用途：

- 給与入力
- 定例支出
- 旅行パターン

給与は特別扱いしない。

## 6. 月次概念

月次上限管理は行わない。

月は：

- 表示フィルタ
- レポート集計軸

としてのみ使用。

## 7. 未来取引の扱い

- 未来日入力可能
- 内部残高には含めない
- 当該年度に入った時点で予算へ影響
- 予算表示も transactionDate 基準

## 8. 可視化指標

本システムの主要指標：

1. 内部残高
2. 自由残高
3. 積立充足率
4. 年度予算差分
5. カテゴリ別実績
6. イベント別総額

## 9. 制約思想

本システムは：

- 入力を強制停止しない
- 予算超過を禁止しない
- 積立不足を禁止しない

代わりに：

- 常時可視化
- 警告表示
- 差分明示

を行う。

## 10. 設計哲学まとめ

本システムは：

- 完全会計システムではない
- 財務統制システムでもない
- 意思決定支援システムである

構造原則：

- 年度は予算の境界
- 財務は連続体
- 積立は意思表示
- 予算は目安
- 残高は派生値

## 11. ドメイン構造（概念図）

- Transaction
- FiscalYear
- Budget
- Saving（積立）
- Event
- EventTemplate
- Category
- 内部残高（派生）
