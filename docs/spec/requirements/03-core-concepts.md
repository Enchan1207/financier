# 3. システムの基本概念

- 索引: [要求仕様書](../requirements.md)
- 関連機能: [機能仕様書](../functions.md)
- 関連ユースケース: [ユースケース定義書](../usecases.md)

---

本システムは以下の概念で構成される。

## 3.1 トランザクション

収入または支出の記録単位。日々の収支はすべてトランザクションとして記録される。

## 3.2 カテゴリ

トランザクションを分類するための概念。収入カテゴリと支出カテゴリの2種別を持つ。年度に依存しないシステム共通の概念である。

トランザクション登録・更新時は、`Transaction.type` と `Category.type` を一致させる（収入は収入カテゴリのみ、支出は支出カテゴリのみ）。

## 3.3 年度

会計の区切りとなる期間。4月1日〜翌年3月31日を1年度とする。予算管理の境界として機能する。

## 3.4 予算

年度×カテゴリ単位で設定される金額の目安。強制力は持たず、実績との差分を可視化するために使用する。

※ 予算実績の集計には、未来日のトランザクションを含めない。当該日に到達した時点で実績に反映される。

## 3.5 積立定義

将来の支出に備えて資金を確保するための仕組み。支出カテゴリと 0..1 : 1 の関係を持つ独立したエンティティである。積立への拠出は、紐づくカテゴリへの通常の支出トランザクションとして記録する。取り崩し時には支出トランザクションを生成せず、取り崩し履歴（SavingWithdrawal）として記録する。積立残高は永続保存せず、拠出トランザクションと取り崩し履歴から常に集計で算出する。

※ 積立拠出として登録する支出トランザクションの日付は、当日または過去日のみ許可する（未来日は不可）。

積立定義は、支出カテゴリ作成時に積立として作成する場合のみ作成可能とし、カテゴリ作成後に積立化の可否を変更することはできない。

## 3.6 イベント

トランザクションを横断的にグルーピングするための概念。旅行・給与一式など、目的単位で取引を束ねる。年度を跨いで利用できる。

## 3.7 イベントテンプレート

繰り返し発生するイベント（給与入力・旅行パターンなど）のテンプレート。一括登録の元データとなる。

テンプレート取引は `status=active` かつ積立定義非紐付けカテゴリのみを対象とする。取引種別（`Transaction.type`）はテンプレートで直接指定せず、保存時にカテゴリ種別（`Category.type`）から決定する。

## 3.8 内部残高

全期間の収入合計と支出合計の差分から算出される派生値。利用者の「財政体力」を示す指標であり、ドメインレベルの仮想的な概念である。実口座残高との一致は保証しない。

```
内部残高 = 全期間の収入合計 − 全期間の支出合計（積立カテゴリを含む）
```

※ 未来日のトランザクションは算出対象に含めない。
