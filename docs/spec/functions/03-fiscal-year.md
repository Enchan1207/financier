# 4. 年度（FiscalYear）

- 索引: [機能仕様書](../functions.md)
- 関連要件: [要求仕様書](../requirements.md)
- 関連ユースケース: [ユースケース定義書](../usecases.md)

---

## 4.1 定義

会計の区切りとなる期間。予算管理の境界として機能する。

## 4.2 属性

| 属性名 | 型              | 必須 | 説明                                |
| ------ | --------------- | ---- | ----------------------------------- |
| id     | ID              | ○    | 一意識別子                          |
| year   | 整数            | ○    | 年度（開始年。例: 2026年度 → 2026） |
| status | active / closed | ○    | 年度状態                            |

## 4.3 期間定義

- 4月1日開始〜翌年3月31日終了
- 例: 2026年度 = 2026年4月1日 〜 2027年3月31日

## 4.4 状態遷移

```
active ──→ closed
```

- **active**: 編集可能。トランザクションの追加・編集・削除、予算の設定・変更が可能
- **closed**: 締め済み。当該年度に属するトランザクション・予算は一切変更不可

## 4.5 年度締め時の動作

1. 当該年度のトランザクションをロック（編集・削除不可）
2. 当該年度の予算を固定
3. 次年度を生成（任意で前年度の予算設定をコピー可能）
4. 積立定義は変更なし（年度非依存のため）
5. イベントは変更なし（年度非依存のため）

## 4.6 予算繰越

予算の繰越は行わない。未使用予算は消滅する。

## 4.7 年度解決と生成ポリシー

- 年度状態の判定は `closed` を優先する
- 対象年の `FiscalYear` が未生成の場合は active 相当として扱う
- `FiscalYear` の物理レコード生成は遅延可能とし、以下の契機で生成する
  - 年度締め時の次年度生成
  - 当該年度に対する初回予算設定時
  - 当該年度到達日（4月1日）の定期処理

---
