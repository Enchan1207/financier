# 2. カテゴリ系

- 索引: [ユースケース定義書](../usecases.md)
- 関連機能: [機能仕様書](../functions.md)
- 関連要件: [要求仕様書](../requirements.md)

---

## UC-2.1 カテゴリの作成

**概要**: 新しいカテゴリを作成する。

**基本フロー**:

1. 利用者がカテゴリ種別（収入/支出）を選択する
2. カテゴリ名を入力する
3. （支出カテゴリの場合）「このカテゴリを積立として作成する」を選択できる
4. （3で選択した場合）積立設定を入力する（[UC-4.1](./04-saving.md#uc-4-1)）
5. 保存する

**事後条件**:

- カテゴリが `status=active` で作成される
- （積立として作成した場合）積立定義が同時に作成される

**補足**:

- 積立として作成するかどうかはカテゴリ作成時にのみ決定でき、作成後は変更できない

---

## UC-2.2 カテゴリの編集

**概要**: 既存カテゴリの名称を変更する。

**基本フロー**:

1. 利用者がカテゴリ一覧から対象カテゴリを選択し、詳細画面へ遷移する
2. カテゴリ名を編集する
3. 保存する

**システム動作**:

- `status=active` のカテゴリのみ編集可能
- カテゴリ名は空文字を許可しない
- 既存カテゴリ名との重複（前後空白除去後）は許可しない

**事後条件**:

- カテゴリ名が更新される
- 既存トランザクション・予算への影響なし

---

## UC-2.3 カテゴリの削除（論理削除）

**概要**: カテゴリの `status` を `archived` に変更し、新規利用を停止する（論理削除）。

**基本フロー**:

1. 利用者が対象カテゴリを選択する
2. 削除を実行する

**システム動作**:

- 積立定義が紐づくカテゴリは UI 上「積立カテゴリ」として表示する
- 積立カテゴリを削除する際に、積立専用の追加確認や警告は表示しない
- `status=archived` のカテゴリは新規トランザクション作成・編集時の選択肢に表示しない
- `status=archived` のカテゴリへの新規指定・変更を伴うトランザクション登録・更新は拒否する
- 既存トランザクションが `status=archived` のカテゴリを参照している場合、カテゴリ変更なしの更新は許可する
- カテゴリ削除は物理削除とし、トランザクション・予算・積立定義の参照がすべて 0 件の場合のみ許可する

**事後条件**:

- カテゴリが `status=archived`（削除済み）になる
- 新規トランザクション作成時の選択肢に表示されなくなる
- 既存トランザクション・予算は影響を受けない

---
